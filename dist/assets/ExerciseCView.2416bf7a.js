import{b as n,c as i,F as v,k as g,t as m,r as u,o as b,j as k,g as e,l as w}from"./index.89c33ed2.js";import{s as d}from"./supabase.d4556b71.js";const y={class:"user-info"},z={name:"UserInfo",props:{data:{type:Array,required:!0}},setup(o){return(l,s)=>(n(),i("ul",y,[(n(!0),i(v,null,g(o.data,t=>(n(),i("li",{key:t.id},m(t.ip_address),1))),128))]))}};const A={class:"flex"},D=e("div",{class:"flex-item"},[e("strong",null,"Reflektion"),e("p",null,"Da Github-Pages Content nur statisch ausliefert, muss ich zum Abgreifen der IP-Adresse auf einen Service zur\xFCckgreifen. Bei eigenem Webserver kann darauf verzichtet werden und man hat die M\xF6glichkeit z.B. mit JSP die IP-Adresse abzufragen und global zu speichern: "),e("code",null,"const ip = '<%=request.getRemoteHost();%>';"),e("p",null,"Die n\xE4chsten Schritte \xE4hneln denen aus Aufgabe 2. Sobald der Besucher die Seite betritt, wird die ermittelte IP-Adresse in einer Datenbank-Tabelle gespeichert - es wird allerdings vorher gepr\xFCft, ob die letzte Zeile der Tabelle bereits die aktuelle IP-Adresse enth\xE4lt, um Dopplungen zu vermeiden. Danach wird \xFCber WebSockets ein bidirktionaler Kanal zur Datenbank-Tabelle aufgebaut und auf Update-Events geh\xF6rt. ")],-1),x={class:"flex-item"},I={class:"ip"},B=e("p",null,"Die letzten zehn Besucher:",-1),P={key:1},R={name:"ExerciseCView",setup(o){const l=u(!1),s=u([]),t=u(null),c=u(null);async function p(){return(await(await fetch("https://api.db-ip.com/v2/free/self")).json()).ipAddress}async function _(a){const{data:r}=await d.from("users").select("id, ip_address").order("created_at",{ascending:!1}).limit(a);return r.reverse()}return b(async()=>{l.value=!0,t.value=await p();const a=await _(1);(!a.length||a[0].ip_address!=t.value)&&await d.from("users").insert([{ip_address:t.value}]),s.value=await _(10),c.value=d.from("users").on("INSERT",r=>{const{id:f,ip_address:h}=r.new;s.value.length===10&&s.value.splice(0,1),s.value.push({id:f,ip_address:h})}).subscribe(),l.value=!1}),k(()=>{d.removeSubscription(c.value)}),(a,r)=>(n(),i("section",A,[D,e("div",x,[e("div",I,[B,l.value?(n(),i("span",P," Daten werden geladen... ")):(n(),w(z,{key:0,data:s.value},null,8,["data"]))])])]))}};export{R as default};
